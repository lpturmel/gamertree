import { FunctionComponent, useState, ChangeEvent} from "react";
import { CgCheck, CgClose } from "react-icons/cg";
import { useQueryClient } from "react-query";
import CustomHead from "../components/Head";
import Input from "../components/intrinsic/Input";
import Spinner from "../components/intrinsic/Spinner";
import Layout from "../components/layout";
import Navbar from "../components/layout/Navbar";
import useNewUsername from "../hooks/useNewUsername";
import useUsernameAvailability from "../hooks/useUsernameAvailability";
import { Profile  } from "../types/Profile";

export interface SettingsProps {}

const Settings: FunctionComponent<SettingsProps> = () => {
    const queryClient = useQueryClient();
    const profile = queryClient.getQueryData<Profile>("profile");
    const { mutate } = useNewUsername();
    const [username, setUsername] = useState("");
    const userAvailability = useUsernameAvailability(username);

    const handleBlur = () => {
    
       userAvailability.refetch()
    }
    console.log(profile.);
    const handleChange = (e: ChangeEvent<HTMLInputElement>) => {
       setUsername(e.target.value) 
    }

    const handleNameReservation = () => {
        mutate(username);
    }
	return (
		<Layout>
			<CustomHead title="Settings" />

			<Navbar />

			<div className="vstack container mx-auto max-w-sm space-y-4 pt-8">
				<div className="vstack space-y-2">
					<p className="title">User information</p>
					<label> Public username </label>
					<div className="relative">
						<Input value={username} onChange={handleChange} onBlur={handleBlur} className="pl-36" />
						<p className="absolute top-2 left-4 font-bold text-white">
							gamertree.com/
						</p>

                        {userAvailability.isLoading && <Spinner className="absolute -right-6 top-3"  />}
                        {userAvailability.isError && <CgClose className="absolute -right-6 top-3 text-red-500" />}
                        {userAvailability.data && <CgCheck className="absolute -right-6 top-3 text-green-500" />}
					</div>
					<div className="flex flex-row w-full justify-end">
						<button onClick={handleNameReservation} className="btn-main">Save</button>
					</div>
				</div>
				<div className="vstack space-y-2">
					<p className="title"> Data removal </p>
					<button className="danger-icon">Delete Account</button>
				</div>
			</div>
		</Layout>
	);
};

export default Settings;
